{% extends "admin/partials/dashboard.html" %} {% block content %}
<h2>Group - {* group.name *}</h2>

<h4>Users</h4>
<div class="table-responsive">
  <table class="table table-striped table-sm">
    <thead>
      <tr>
        <th>#</th>
        <th>Username</th>
        <th>Email</th>
        <th>Account Verified</th>
        <th>Account Created</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% if users.data %} {% for user in users.data %}
      <tr>
        <td>{* user.id *}</td>
        <td>{* user.username *}</td>
        <td>{* user.email *}</td>
        <td>{* user.email_verified *}</td>
        <td>{* user.created_at|date("d/M/Y") *}</td>
        <td>
          <button type="button" class="btn btn-primary btn-sm float-right">
            Actions
          </button>
        </td>
      </tr>
      {% endfor %} {% else %}
      <tr>
        <td colspan="5">
          <div class="alert alert-primary">No Users Found</div>
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</div>
<nav aria-label="Page navigation example">
  <ul class="pagination">
    <li class="page-item {% if users.current_page <= 1 %} disabled {% endif %}">
      <a class="page-link" href="{* users.prev_page_url *}">Previous</a>
    </li>
    {% if (users.current_page - 1) > 0 %}
    <li class="page-item">
      <a class="page-link" href="/admin/users?page={* users.current_page - 1 *}">
        {* users.current_page - 1 *}</a
      >
    </li>
    {% endif %}
    <li class="page-item active">
      <a class="page-link" href="#">{* users.current_page *}</a>
    </li>
    {% if (users.current_page + 1) <= users.last_page %}
    <li class="page-item">
      <a class="page-link" href="/admin/users?page={* users.current_page + 1 *}">{*
        users.current_page + 1
      *}</a>
    </li>
    {% endif %}
    <li
      class="page-item {% if users.current_page == users.last_page %} disabled {% endif %}"
    >
      <a class="page-link" href="{* users.next_page_url *}">Next</a>
    </li>
  </ul>
</nav>

<!-- Role selector -->
<div class="container">
  <div class="row" id="add-section">
    <div class="col">
        <h4 class="text-center">Available Roles</h4>
      <div class="card" >
        <div id="accordion">
            <div class="card" v-for="(category, index) in userRoles"  v-if="category.roles.length">
                <div class="card-header">
                    <a href="" class="card-link" data-toggle="collapse" v-on:click="userRoles[index].show = !userRoles[index].show">
                {{category.name}}
            </a>
                </div>
                <div v-bind:id="'#collapse_' + index" class="collapse" v-bind:class="{show: category.show}" data-parent="#accordion">
                    <ul class="list-group">
                        <li class="list-group-item" v-for="(role, idx) in category.roles">
                            <span>{{role.name}}</span>
                            <button class="btn btn-sm btn-primary float-right align-middle" :data-role="idx" :data-category="index" v-on:click="addRole">
                      <i class="fas fa-plus"></i>
                  </button>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
    </div>
    <div class="col">
        <h4 class="text-center">Added Roles</h4>
      <div class="card">
        <div id="accordion">
            <div class="card" v-for="(category, index) in addedRoles" v-if="category.roles.length">
                <div class="card-header">
                    <a href="" class="card-link" data-toggle="collapse" v-on:click="addedRoles[index].show = !addedRoles[index].show">
                {{category.name}}
            </a>
                </div>
                <div v-bind:id="'#collapse_' + index" class="collapse" v-bind:class="{show: category.show}" data-parent="#accordion">
                    <ul class="list-group">
                        <li class="list-group-item" v-for="(role, idx) in category.roles">
                            <span>{{role.name}}</span>
                            <button class="btn btn-sm btn-danger float-right align-middle" :data-role="idx" :data-category="index" v-on:click="removeRole">
                      <i class="fas fa-minus"></i>
                  </button>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
    </div>
  </div>
</div>

<!-- End role selector -->

<script>
new Vue({
    el: "#add-section",
    data: {
        userRoles: [
            {
                id:"1",
                name: "Admin",
                show: true,
                roles: [
                    {
                        name: "Open admin page"
                    },
                    {
                        name: "See users page"
                    },
                    {
                        name: "See groups page"
                    }
                ]
            },
            {
                id:"2",
                name: "Search Bar",
                show: true,
                roles: [
                    {
                        name: "Search for users"
                    },
                    {
                        name: "Search for groups"
                    },
                    {
                        name: "Search for roles"
                    }
                ]
            }
        ],
        addedRoles: [{
            id: '1',
            name: 'Admin',
            show: true,
            roles: [{
                name: 'Validate Users',
                id: 10
            }]
        }, {
            id: '2',
            name: 'Search Bar',
            show: false,
            roles: []
        }]
    },
    methods: {
        addRole: function(ev) {
            var role = ev.currentTarget.getAttribute('data-role');
            var category = ev.currentTarget.getAttribute('data-category')
            var role = this.userRoles[category].roles[role];
            this.addedRoles[category].roles.push(role);
            this.addedRoles[category].show = true;
            this.userRoles[category].roles.splice(role, 1);
        },
        removeRole: function(ev) {
            var role = ev.currentTarget.getAttribute('data-role');
            var category = ev.currentTarget.getAttribute('data-category')
            var role = this.addedRoles[category].roles[role];
            this.userRoles[category].roles.push(role);
            this.userRoles[category].show = true;
            this.addedRoles[category].roles.splice(role, 1);
        }
    }
});

</script>
{% endblock %}
